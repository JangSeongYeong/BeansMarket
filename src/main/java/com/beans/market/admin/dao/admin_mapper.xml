<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beans.market.admin.dao.AdminDAO">	
	
	<!-- 성영 -->
	<select id="login" resultType="com.beans.market.admin.dto.AdminDTO">
		SELECT id, admin_name FROM admin WHERE id = #{param1} AND pw = #{param2}
	</select>

	<select id="alarm" resultType="com.beans.market.admin.dto.AlarmDTO">
		SELECT idx, content, checked, reg_date, link
			FROM admin_alarm
			ORDER BY reg_date DESC
	</select>
	
	<select id="noCompleteInquiry" resultType="Integer">
		SELECT COUNT(*) AS no_complete_cnt 
			FROM inquiry i LEFT JOIN inq_reply ir 
				ON i.inquiry_idx = ir.inquiry_idx 
			WHERE ir.inquiry_idx IS NULL
	</select>
	
	<select id="noCompleteReport" resultType="Integer">
		SELECT COUNT(report_complete) AS no_complete_cnt 
			FROM report 
			WHERE report_complete = 'N'
	</select>
	
	<update id="alarmRead">
		UPDATE admin_alarm SET checked = 'Y' WHERE idx = #{param1}
	</update>
	
	<select id="newAlarm" resultType="Integer">
		SELECT COUNT(checked) AS cnt 
			FROM admin_alarm
			WHERE checked = 'N'
	</select>

	<select id="messageList" resultType="com.beans.market.message.dto.MessageDTO">
		SELECT 
			message_idx, 
			content, 
			reg_date, 
			receive_email, 
			receive_del, 
			sender_email, 
			sender_del,
			read_check,
			idx
		FROM 
			deal_message
		WHERE 
			CASE WHEN #{param1} = 0 THEN 1=1 ELSE message_idx = #{param1} END
	</select>
	
	<select id="messageReportList" resultType="com.beans.market.message.dto.MessageDTO">
		SELECT 
			dm.message_idx, 
			dm.content, 
			dm.reg_date, 
			dm.receive_email, 
			dm.receive_del, 
			dm.sender_email, 
			dm.sender_del,
			dm.read_check,
			dm.idx,
			r.idx,
			r.report_complete
		FROM deal_message dm 
		LEFT JOIN 
			(SELECT r.report_idx, r.option_idx, r.idx, r.report_complete, r.reg_date FROM report r WHERE r.option_idx = 'RB003' AND r.report_complete = 'N') AS r
			ON dm.message_idx = r.idx
		WHERE r.idx IS NOT NULL AND
			CASE WHEN #{param1} = 0 THEN 1=1 ELSE dm.message_idx = #{param1} END
		ORDER BY r.reg_date
	</select>
	
	
	<select id="roomListCall" resultType="com.beans.market.message.dto.MessageDTO">
		SELECT dm.idx, dm.sender_email, dm.receive_email, b.subject, dm.reg_date
			FROM deal_message dm LEFT JOIN (SELECT b.idx, b.email, b.subject FROM bbs b) AS b ON dm.idx = b.idx
			WHERE dm.receive_email = b.email AND
				CASE WHEN #{param1} = 0 THEN 1=1 ELSE dm.idx = #{param1} END
			GROUP BY dm.idx, dm.receive_email, dm.sender_email
			ORDER BY dm.idx
	</select>
	
	<select id="roomReportListCall" resultType="com.beans.market.message.dto.MessageDTO">
		SELECT dm.idx, dm.sender_email, dm.receive_email, b.subject, dm.reg_date, r.report_idx, r.perpet_email, r.reporter_email 
			FROM deal_message dm 
			LEFT JOIN (SELECT b.idx, b.email, b.subject FROM bbs b) AS b 
				ON dm.idx = b.idx
			LEFT JOIN (SELECT r.report_idx, r.option_idx, r.idx, r.report_complete, r.reg_date, r.perpet_email, r.reporter_email FROM report r WHERE r.option_idx = 'RB002' AND r.report_complete = 'N') AS r
				ON dm.idx = r.idx 
					AND (dm.sender_email = r.reporter_email OR dm.sender_email = r.perpet_email)
					AND (dm.receive_email = r.reporter_email OR dm.receive_email = r.perpet_email)
			WHERE dm.receive_email = b.email AND r.idx IS NOT NULL AND
				CASE WHEN #{param1} = 0 THEN 1=1 ELSE dm.idx = #{param1} END
			GROUP BY dm.idx, dm.receive_email, dm.sender_email
			ORDER BY dm.idx
	</select>
	<!-- GROUP BY에 r.report_idx를 추가하면 신고 번호에 대해서도 구분할 수 있다. -->

	
	<!-- 성영 END -->
		
	
	
	
	
	
	
	
	
	
	
	
	<!-- 도혜 -->
	<!-- 회원 관리 -->
	<select id="memberSelect1" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
	</select>
	<select id="memberSelect2" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01'
	</select>
	<select id="memberSelect3" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31'
	</select>
	<select id="memberSelect4" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y'
	</select>
	<select id="memberSelect5" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y'
	</select>
	<select id="memberSelect6" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE warn_count = #{param1}
	</select>
	<select id="memberSelect7" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '1970-01-01' AND warn_count = #{param1}
	</select>
	<select id="memberSelect8" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '9999-12-31' AND warn_count = #{param1}
	</select>
	<select id="memberSelect9" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND warn_count = #{param1}
	</select>
	<select id="memberSelect10" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND warn_count = #{param1}
	</select>
	<select id="memberSelect11" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE email like #{param1} or name like #{param1}
	</select>
	<select id="memberSelect12" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect13" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect14" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect15" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect16" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect17" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect18" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect19" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect20" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN (SELECT COUNT(email) FROM member WHERE warn_count > 9) > 0 THEN 'Y'
				ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
</mapper>