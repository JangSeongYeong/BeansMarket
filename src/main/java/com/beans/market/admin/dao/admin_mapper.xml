<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beans.market.admin.dao.AdminDAO">	
	
	
	<select id="login" resultType="com.beans.market.admin.dto.AdminDTO">
		SELECT id, admin_name FROM admin WHERE id = #{param1} AND pw = #{param2}
	</select>

	<select id="alarm" resultType="com.beans.market.admin.dto.AlarmDTO">
		SELECT idx, content, checked, reg_date, link
			FROM admin_alarm
			ORDER BY reg_date DESC
	</select>
	
	<select id="noCompleteInquiry" resultType="Integer">
		SELECT COUNT(*) AS no_complete_cnt 
			FROM inquiry i LEFT JOIN inq_reply ir 
				ON i.inquiry_idx = ir.inquiry_idx 
			WHERE ir.inquiry_idx IS NULL
	</select>
	
	<select id="noCompleteReport" resultType="Integer">
		SELECT COUNT(report_complete) AS no_complete_cnt 
			FROM report 
			WHERE report_complete = 'N'
	</select>
	
	<update id="alarmRead">
		UPDATE admin_alarm SET checked = 'Y' WHERE idx = #{param1}
	</update>
	
	<select id="newAlarm" resultType="Integer">
		SELECT COUNT(checked) AS cnt 
			FROM admin_alarm
			WHERE checked = 'N'
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 도혜 -->
	<!-- 회원 관리 -->
	<select id="memberSelect1" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
	</select>
	<select id="memberSelect2" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01' AND login_banend != '9999-12-31'
	</select>
	<select id="memberSelect3" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31'
	</select>
	<select id="memberSelect4" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y'
	</select>
	<select id="memberSelect5" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y'
	</select>
	<select id="memberSelect6" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE warn_count = #{param1}
	</select>
	<select id="memberSelect7" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '1970-01-01' AND login_banend != '9999-12-31' AND warn_count = #{param1}
	</select>
	<select id="memberSelect8" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '9999-12-31' AND warn_count = #{param1}
	</select>
	<select id="memberSelect9" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND warn_count = #{param1}
	</select>
	<select id="memberSelect10" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND warn_count = #{param1}
	</select>
	<select id="memberSelect11" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE email like #{param1} or name like #{param1}
	</select>
	<select id="memberSelect12" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01' AND login_banend != '9999-12-31' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect13" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect14" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect15" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND (email like #{param1} or name like #{param1})
	</select>
	<select id="memberSelect16" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect17" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend != '1970-01-01' AND login_banend != '9999-12-31' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect18" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE login_banend = '9999-12-31' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect19" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE dormant = 'Y' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<select id="memberSelect20" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, 
			name, 
			warn_count, 
			login_banend,
			CASE 
				WHEN warn_count = 9 THEN 'Y'
           		ELSE 'N'
			END AS permanent_ban, 
			dormant, 
			secession
		FROM member
		WHERE secession = 'Y' AND warn_count = #{param1} AND (email like #{param2} or name like #{param2})
	</select>
	<!-- 유저 제제 -->
	<insert id="userManageDo" parameterType="map">
		INSERT INTO member_penalty(option, content, admin_name, email)
		VALUES(#{manageOption}, #{manageContent}, #{adminID}, #{memberEmail});
	</insert>
	<update id="userManageUpdate1" parameterType="map">
		UPDATE member SET warn_count = warn_count+1 WHERE email = #{memberEmail}
	</update>
	<update id="userManageUpdate2" parameterType="map">
		UPDATE member SET warn_count = warn_count-1 WHERE email = #{memberEmail}
	</update>
	<update id="userManageUpdate3" parameterType="map">
		UPDATE member
		SET login_banstr = CURDATE(),
		    login_banend = DATE_ADD(CURDATE(), INTERVAL 3 DAY)
		WHERE email = #{memberEmail}
	</update>
	<update id="userManageUpdate4" parameterType="map">
		UPDATE member
		SET login_banstr = NULL,
		    login_banend = '1970-01-01'
		WHERE email = #{memberEmail}
	</update>
	<update id="userManageUpdate5" parameterType="map">
		UPDATE member 
		SET warn_count = 9 ,
			login_banend = '9999-12-31'
		WHERE email = #{memberEmail}
	</update>
	<!-- 회원 정보 불러오기 -->
	<!-- ** 정보약관동의 없음, 로그인 벤 날짜 시작날짜 null 처리 select email, name, location, scope, gender, birth_date, last_login, dormant, secession, point, warn_count, login_banstr, login_banend from member; -->
	<select id="getMemberProfile" resultType="com.beans.market.member.dto.MemberDTO">
		SELECT email, name, location, scope, gender, birth_date, last_login, dormant, secession, point, warn_count, login_banstr, login_banend 
		FROM member
		WHERE email = #{param1}
	</select>
	<select id="getmemberProfilePic" resultType="String">
		SELECT new_filename
		FROM member_profilepic
		WHERE email = #{param1}
	</select>
	<!-- 회원 포인트 수정 -->
	<update id="userPointUpdate1">
		update member set point = point + #{param2} where email = #{param1}
	</update>
	<insert id="userPointUpdate1Insert">
		INSERT INTO pay_hist(email, option, price, content)
		VALUES(#{param1}, '관리자 입금', #{param2}, '관리자 입금');
	</insert>
	<update id="userPointUpdate2">
		update member set point = point - #{param2} where email = #{param1}
	</update>
	<insert id="userPointUpdate2Insert">
		INSERT INTO pay_hist(email, option, price, content)
		VALUES(#{param1}, '관리자 출금', #{param2}, '관리자 출금');
	</insert>

</mapper>