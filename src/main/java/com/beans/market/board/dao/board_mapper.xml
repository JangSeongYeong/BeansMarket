<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beans.market.board.dao.BoardDAO">	
	
	<update id="upHit">
		UPDATE bbs SET bHit = bHit+1 WHERE idx = #{param1}
	</update>
	
	<select id="goodsDetail" resultType="com.beans.market.board.dto.BoardDTO">
		SELECT idx, email, option, subject, price, place, reg_date, content, hidden, bbs_state FROM bbs
			WHERE idx = #{param1}
	</select>
	
	<select id="auctionDetail" resultType="com.beans.market.board.dto.BoardDTO">
		SELECT b.idx, b.email, b.option, b.subject, b.price, b.place, b.reg_date, b.content, b.hidden, b.bbs_state, a.start_price, a.successful_bid, a.auction_period, a.close_date, a.bid_count 
			FROM auction a join bbs b on a.idx=b.idx WHERE b.idx = #{param1}
	</select>
	
	<insert id="interestInsert">
		INSERT INTO interest(idx, email)
			VALUES(#{param1}, #{param2})
	</insert>
	
	<delete id="interestDel">
		DELETE FROM interest WHERE idx = #{param1} AND email = #{param2}
	</delete>
	
	<update id="bidResultUpdate">
		UPDATE bbs AS b
			JOIN auction AS a ON b.idx = a.idx 
			SET b.price = #{param2}, a.bid_count = a.bid_count + 1 
		WHERE b.idx = #{param1} AND a.idx = #{param1}
	</update>
	
	<update id="updateBbsState">
		UPDATE bbs SET bbs_state = #{param2} WHERE idx = #{param1}
	</update>
	
	<update id="updateCloseDate">
		UPDATE auction SET close_date = #{param2} WHERE idx = #{param1}
	</update>
	
	<select id="getEmail" resultType="String">
		SELECT email FROM bbs WHERE idx = #{param1};
	</select>
	
	<!-- 글작성 ::판매 이미지도 해야함!!!!!!!!!!!!, 가격,사용자 위치, -->
	<insert id="writeBoard"
			useGeneratedKeys="true"
			keyColumn="idx"
			keyProperty="idx"
			parameterType="com.beans.market.board.dto.BoardDTO">
		INSERT into bbs(email, option, category_idx, subject, content, place)
		VALUES (#{email}, #{option}, #{category_idx}, #{subject}, #{content}, #{place});
	</insert>
	<!-- 글작성 ::판매 -->
	<update id="updatePrice">
		UPDATE bbs 
		SET price = #{param1} 
		WHERE idx = #{param2}
	</update>
	<update id="updateAuctionPrice">
		UPDATE bbs 
		SET price = #{param1} 
		WHERE idx = #{param3}
	</update>
	<insert id="updateAuctionPrice2">
		INSERT INTO auction(start_price, successful_bid, auction_period, idx)
		VALUES(#{param1}, #{param2}, #{param3},  #{param4});
	</insert>
	<!-- main, new_picname, idx, option_idx -->
	<!-- void savePhoto(int idx, String orifilename, String newfileName); -->
	<insert id="savePhoto">
		INSERT INTO photo (idx, option_idx, main, new_picname)
		VALUES(#{param1}, 1, 'Y', #{param3})
	</insert>
	<insert id="savePhoto2">
		INSERT INTO photo (idx, option_idx, main, new_picname)
		VALUES(#{param1}, 1, 'N', #{param3})
	</insert>

	
</mapper>